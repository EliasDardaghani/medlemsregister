<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Föreningens Medlemsregister</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-indigo-900 mb-2 flex items-center gap-2">
                <i data-lucide="users" class="w-8 h-8"></i>
                Föreningens Medlemsregister
            </h1>
            <p class="text-gray-600">Hantera medlemmar och registrera närvaro</p>
            <div class="mt-4 flex gap-2">
                <button onclick="exportData()" class="bg-green-600 text-white px-4 py-2 rounded font-semibold hover:bg-green-700 transition-colors flex items-center gap-2">
                    <i data-lucide="download" class="w-4 h-4"></i>
                    Exportera data
                </button>
                <label class="bg-blue-600 text-white px-4 py-2 rounded font-semibold hover:bg-blue-700 transition-colors flex items-center gap-2 cursor-pointer">
                    <i data-lucide="upload" class="w-4 h-4"></i>
                    Importera data
                    <input type="file" accept=".json" onchange="importData(event)" class="hidden">
                </label>
            </div>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-lg shadow-lg mb-6">
            <div class="flex border-b">
                <button onclick="showTab('members')" id="tab-members" class="flex-1 py-4 px-6 font-semibold transition-colors bg-indigo-500 text-white">
                    <i data-lucide="users" class="w-5 h-5 inline mr-2"></i>
                    Medlemmar
                </button>
                <button onclick="showTab('attendance')" id="tab-attendance" class="flex-1 py-4 px-6 font-semibold transition-colors bg-gray-100 text-gray-700 hover:bg-gray-200">
                    <i data-lucide="calendar" class="w-5 h-5 inline mr-2"></i>
                    Närvaro
                </button>
                <button onclick="showTab('stats')" id="tab-stats" class="flex-1 py-4 px-6 font-semibold transition-colors bg-gray-100 text-gray-700 hover:bg-gray-200">
                    <i data-lucide="trending-up" class="w-5 h-5 inline mr-2"></i>
                    Statistik
                </button>
            </div>

            <div class="p-6">
                <!-- Members Tab -->
                <div id="content-members">
                    <div class="mb-6 bg-indigo-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">
                            <i data-lucide="user-plus" class="w-5 h-5"></i>
                            Lägg till ny medlem
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <input type="text" id="member-name" placeholder="Namn" class="px-4 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                            <input type="email" id="member-email" placeholder="E-post (valfritt)" class="px-4 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                            <button onclick="addMember()" class="bg-indigo-600 text-white px-6 py-2 rounded font-semibold hover:bg-indigo-700 transition-colors">
                                Lägg till
                            </button>
                        </div>
                    </div>
                    <div id="members-list"></div>
                </div>

                <!-- Attendance Tab -->
                <div id="content-attendance" style="display:none;">
                    <div class="mb-6 bg-indigo-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">
                            <i data-lucide="calendar" class="w-5 h-5"></i>
                            Skapa nytt möte/aktivitet
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <input type="text" id="meeting-name" placeholder="Namn på möte/aktivitet" class="px-4 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                            <input type="date" id="meeting-date" class="px-4 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                            <button onclick="addMeeting()" class="bg-indigo-600 text-white px-6 py-2 rounded font-semibold hover:bg-indigo-700 transition-colors">
                                Skapa möte
                            </button>
                        </div>
                    </div>
                    <div id="meetings-list"></div>
                </div>

                <!-- Stats Tab -->
                <div id="content-stats" style="display:none;">
                    <div id="stats-content"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let members = [];
        let meetings = [];

        // Ladda data från localStorage
        function loadData() {
            const savedMembers = localStorage.getItem('members');
            const savedMeetings = localStorage.getItem('meetings');
            
            if (savedMembers) {
                members = JSON.parse(savedMembers);
            } else {
                members = [
                    { id: 1, name: 'Anna Andersson', joinDate: '2024-01-15', email: 'anna@example.com' },
                    { id: 2, name: 'Erik Eriksson', joinDate: '2024-02-20', email: 'erik@example.com' }
                ];
            }
            
            if (savedMeetings) {
                meetings = JSON.parse(savedMeetings);
            } else {
                meetings = [
                    { id: 1, date: '2024-09-15', name: 'Årsmöte', attendance: [1, 2] }
                ];
            }
        }

        // Spara data
        function saveData() {
            localStorage.setItem('members', JSON.stringify(members));
            localStorage.setItem('meetings', JSON.stringify(meetings));
        }

        // Uppdatera ikoner
        function refreshIcons() {
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        // Visa tabs
        function showTab(tab) {
            // Uppdatera tab knappar
            const tabs = {
                'members': '<i data-lucide="users" class="w-5 h-5 inline mr-2"></i> Medlemmar',
                'attendance': '<i data-lucide="calendar" class="w-5 h-5 inline mr-2"></i> Närvaro',
                'stats': '<i data-lucide="trending-up" class="w-5 h-5 inline mr-2"></i> Statistik'
            };
            
            Object.keys(tabs).forEach(key => {
                const btn = document.getElementById('tab-' + key);
                btn.className = key === tab 
                    ? 'flex-1 py-4 px-6 font-semibold transition-colors bg-indigo-500 text-white'
                    : 'flex-1 py-4 px-6 font-semibold transition-colors bg-gray-100 text-gray-700 hover:bg-gray-200';
                btn.innerHTML = tabs[key];
            });
            
            // Visa rätt innehåll
            document.querySelectorAll('[id^="content-"]').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById('content-' + tab).style.display = 'block';
            
            // Uppdatera innehåll
            if (tab === 'members') renderMembers();
            if (tab === 'attendance') renderMeetings();
            if (tab === 'stats') renderStats();
            
            refreshIcons();
        }

        // Lägg till medlem
        function addMember() {
            const name = document.getElementById('member-name').value.trim();
            const email = document.getElementById('member-email').value.trim();
            
            if (!name) return;
            
            members.push({
                id: Date.now(),
                name: name,
                email: email,
                joinDate: new Date().toISOString().split('T')[0]
            });
            
            document.getElementById('member-name').value = '';
            document.getElementById('member-email').value = '';
            
            saveData();
            renderMembers();
        }

        // Ta bort medlem
        function removeMember(id) {
            if (!confirm('Är du säker på att du vill ta bort denna medlem?')) return;
            
            members = members.filter(m => m.id !== id);
            meetings.forEach(meeting => {
                meeting.attendance = meeting.attendance.filter(memberId => memberId !== id);
            });
            
            saveData();
            renderMembers();
        }

        // Rendera medlemmar
        function renderMembers() {
            const list = document.getElementById('members-list');
            
            if (members.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center py-8">Inga medlemmar ännu</p>';
                return;
            }
            
            list.innerHTML = '<h3 class="text-lg font-semibold mb-3">Medlemslista (' + members.length + ')</h3><div class="space-y-2">' +
                members.map(member => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <div>
                            <p class="font-semibold text-gray-900">${member.name}</p>
                            <p class="text-sm text-gray-600">${member.email || 'Ingen e-post'} • Medlem sedan: ${member.joinDate}</p>
                        </div>
                        <button onclick="removeMember(${member.id})" class="text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded transition-colors" title="Ta bort medlem">
                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                        </button>
                    </div>
                `).join('') +
            '</div>';
            
            refreshIcons();
        }

        // Lägg till möte
        function addMeeting() {
            const name = document.getElementById('meeting-name').value.trim();
            const date = document.getElementById('meeting-date').value;
            
            if (!name || !date) return;
            
            meetings.push({
                id: Date.now(),
                name: name,
                date: date,
                attendance: []
            });
            
            document.getElementById('meeting-name').value = '';
            document.getElementById('meeting-date').value = '';
            
            saveData();
            renderMeetings();
        }

        // Växla närvaro
        function toggleAttendance(meetingId, memberId) {
            const meeting = meetings.find(m => m.id === meetingId);
            if (!meeting) return;
            
            const index = meeting.attendance.indexOf(memberId);
            if (index > -1) {
                meeting.attendance.splice(index, 1);
            } else {
                meeting.attendance.push(memberId);
            }
            
            saveData();
            renderMeetings();
        }

        // Rendera möten
        function renderMeetings() {
            const list = document.getElementById('meetings-list');
            
            if (meetings.length === 0) {
                list.innerHTML = '<h3 class="text-lg font-semibold mb-3">Möten & Aktiviteter (0)</h3><p class="text-gray-500 text-center py-8">Inga möten skapade ännu</p>';
                return;
            }
            
            list.innerHTML = '<h3 class="text-lg font-semibold mb-3">Möten & Aktiviteter (' + meetings.length + ')</h3><div class="space-y-4">' +
                meetings.map(meeting => {
                    const attendanceHTML = members.length === 0 
                        ? '<p class="text-gray-500 text-sm">Lägg till medlemmar först</p>'
                        : '<div class="space-y-2">' + members.map(member => {
                            const isPresent = meeting.attendance.includes(member.id);
                            return `
                                <button onclick="toggleAttendance(${meeting.id}, ${member.id})" 
                                    class="w-full flex items-center justify-between p-3 rounded-lg transition-all ${
                                        isPresent 
                                            ? 'bg-green-100 border-2 border-green-500' 
                                            : 'bg-gray-50 border-2 border-gray-200 hover:bg-gray-100'
                                    }">
                                    <span class="font-medium ${isPresent ? 'text-green-900' : 'text-gray-700'}">${member.name}</span>
                                    ${isPresent ? '<i data-lucide="check" class="w-5 h-5 text-green-600"></i>' : ''}
                                </button>
                            `;
                        }).join('') + '</div>';
                    
                    return `
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex justify-between items-center mb-4">
                                <div>
                                    <h4 class="font-bold text-lg text-gray-900">${meeting.name}</h4>
                                    <p class="text-sm text-gray-600">${meeting.date} • ${meeting.attendance.length} närvarande</p>
                                </div>
                            </div>
                            ${attendanceHTML}
                        </div>
                    `;
                }).join('') +
            '</div>';
            
            refreshIcons();
        }

        // Rendera statistik
        function renderStats() {
            const totalMembers = members.length;
            const totalMeetings = meetings.length;
            const avgAttendance = meetings.length > 0
                ? (meetings.reduce((sum, m) => sum + m.attendance.length, 0) / meetings.length).toFixed(1)
                : 0;
            
            const memberStats = members.map(member => {
                const attended = meetings.filter(m => m.attendance.includes(member.id)).length;
                const percentage = meetings.length > 0 ? Math.round((attended / meetings.length) * 100) : 0;
                return { ...member, attended, percentage };
            });

            let html = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-indigo-100 p-6 rounded-lg text-center">
                        <p class="text-3xl font-bold text-indigo-900">${totalMembers}</p>
                        <p class="text-indigo-700 font-semibold">Totalt medlemmar</p>
                    </div>
                    <div class="bg-blue-100 p-6 rounded-lg text-center">
                        <p class="text-3xl font-bold text-blue-900">${totalMeetings}</p>
                        <p class="text-blue-700 font-semibold">Totalt möten</p>
                    </div>
                    <div class="bg-green-100 p-6 rounded-lg text-center">
                        <p class="text-3xl font-bold text-green-900">${avgAttendance}</p>
                        <p class="text-green-700 font-semibold">Snitt närvaro/möte</p>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-3">Närvarostatistik per medlem</h3>
            `;

            if (members.length === 0) {
                html += '<p class="text-gray-500 text-center py-8">Inga medlemmar att visa statistik för</p>';
            } else {
                html += '<div class="space-y-2">' +
                    memberStats.map(member => `
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-semibold text-gray-900">${member.name}</span>
                                <span class="text-sm text-gray-600">${member.attended} av ${totalMeetings} möten (${member.percentage}%)</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-indigo-600 h-3 rounded-full transition-all" style="width: ${member.percentage}%"></div>
                            </div>
                        </div>
                    `).join('') +
                '</div>';
            }

            html += '</div>';
            document.getElementById('stats-content').innerHTML = html;
        }

        // Export data
        function exportData() {
            const data = {
                members,
                meetings,
                exportDate: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `medlemsregister-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        // Import data
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.members) members = data.members;
                    if (data.meetings) meetings = data.meetings;
                    saveData();
                    alert('Data importerad!');
                    showTab('members');
                } catch (error) {
                    alert('Fel vid import av data: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // Enter-tangent för att lägga till
        document.getElementById('member-name').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addMember();
        });
        document.getElementById('member-email').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addMember();
        });

        // Initiera när sidan laddas
        window.addEventListener('DOMContentLoaded', function() {
            loadData();
            renderMembers();
            refreshIcons();
        });
    </script>
</body>
</html>